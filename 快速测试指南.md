# 快速测试指南

## 🚀 启动应用

### 开发模式
```bash
npm run dev
```
访问：http://localhost:5173

### 生产模式预览
```bash
npm run build
npm run preview
```
访问：http://localhost:5173

## 📋 测试流程

### 1. 测试注册功能
1. 访问 http://localhost:5173
2. 应该自动跳转到登录页 `/login`
3. 点击"立即注册"
4. 输入微信昵称和密码
5. 注册成功后应该自动跳转到未授权页面 `/not-authorized`（新用户默认没有权限）

### 2. 测试管理员功能
1. 访问 http://localhost:5173/admin/login
2. 使用管理员账号登录
3. 应该进入管理后台 `/admin`
4. 测试以下功能：
   - 查看用户列表
   - 搜索用户
   - 给用户授权（点击"1个月"、"3个月"等按钮）
   - 查看数据看板（点击"数据看板"按钮）
   - 退出登录

### 3. 测试会员功能
1. 先用管理员账号给测试用户授权
2. 退出管理员账号
3. 用测试用户账号登录
4. 应该进入会员中心 `/member`
5. 测试以下功能：
   - 查看授权状态
   - 点击"进入系统"进入复盘系统
   - 退出登录

### 4. 测试权限保护
1. **未登录访问保护页面**
   - 直接访问 http://localhost:5173/member
   - 应该跳转到登录页

2. **普通会员访问管理页面**
   - 用普通会员账号登录
   - 直接访问 http://localhost:5173/admin
   - 应该跳转回登录页

3. **未授权会员访问会员功能**
   - 用管理员撤销某个用户的授权
   - 用该用户登录
   - 应该跳转到未授权页面

## 🔍 检查要点

### 路由跳转检查
- [ ] 根路径 `/` → `/login`
- [ ] 登录成功（有权限会员） → `/member`
- [ ] 登录成功（管理员） → `/admin`
- [ ] 登录成功（无权限） → `/not-authorized`
- [ ] 未登录访问受保护页面 → `/login`

### 页面显示检查
- [ ] 登录页面正常显示
- [ ] 注册页面正常显示
- [ ] 管理员登录页面正常显示
- [ ] 会员中心页面正常显示
- [ ] 管理后台页面正常显示
- [ ] 数据看板页面正常显示
- [ ] 复盘系统（iframe）正常显示
- [ ] 未授权页面正常显示

### 功能操作检查
- [ ] 注册新用户成功
- [ ] 登录成功
- [ ] 退出登录成功
- [ ] 管理员授权用户成功
- [ ] 管理员撤销授权成功
- [ ] 管理员删除用户成功
- [ ] 搜索用户功能正常
- [ ] 导出CSV功能正常
- [ ] 进入复盘系统正常

## ⚠️ 常见问题

### 1. 白屏或空白页
**原因**: 可能是环境变量未配置
**解决**: 
1. 检查是否有 `.env` 文件
2. 确认包含以下变量：
   ```
   VITE_SUPABASE_URL=你的Supabase URL
   VITE_SUPABASE_ANON_KEY=你的Supabase匿名密钥
   ```
3. 重启开发服务器

### 2. 登录后没有跳转
**原因**: 可能是数据库表或权限配置问题
**解决**:
1. 检查 `profiles` 表是否有数据
2. 检查 `access_grants` 表是否有授权记录
3. 在浏览器控制台查看错误信息

### 3. 管理员无法查看用户列表
**原因**: RLS（行级安全）策略限制
**解决**:
1. 检查Supabase中的RLS策略
2. 确保管理员有查询权限
3. 或临时关闭RLS测试

### 4. iframe无法显示
**原因**: CSP（内容安全策略）限制
**解决**:
1. 检查 `public/legacy/index.html` 文件是否存在
2. 检查浏览器控制台的安全错误
3. 可能需要调整CSP策略

## 📊 数据库状态检查

### 使用Supabase Dashboard检查

1. **检查用户表 (profiles)**
   ```sql
   SELECT id, wechat_nickname, is_admin, created_at
   FROM profiles
   ORDER BY created_at DESC;
   ```

2. **检查授权表 (access_grants)**
   ```sql
   SELECT ag.*, p.wechat_nickname
   FROM access_grants ag
   LEFT JOIN profiles p ON ag.user_id = p.id
   ORDER BY ag.granted_at DESC;
   ```

3. **检查过期授权**
   ```sql
   SELECT ag.*, p.wechat_nickname
   FROM access_grants ag
   LEFT JOIN profiles p ON ag.user_id = p.id
   WHERE ag.expires_at IS NOT NULL 
   AND ag.expires_at < NOW()
   ORDER BY ag.expires_at DESC;
   ```

## 🎯 核心功能验证

### 必须通过的测试
1. ✅ 访问根路径自动跳转到登录页
2. ✅ 注册新用户成功
3. ✅ 用户登录成功
4. ✅ 管理员登录成功
5. ✅ 管理员可以授权用户
6. ✅ 授权用户可以访问会员中心
7. ✅ 授权用户可以进入复盘系统
8. ✅ 未授权用户被拒绝访问
9. ✅ 普通用户无法访问管理后台
10. ✅ 退出登录功能正常

## 📝 测试记录模板

```
测试日期：____年____月____日
测试人员：____________

[ ] 1. 路由跳转正常
[ ] 2. 注册功能正常
[ ] 3. 登录功能正常
[ ] 4. 权限检查正常
[ ] 5. 管理员功能正常
[ ] 6. 会员功能正常
[ ] 7. 退出登录正常
[ ] 8. 复盘系统正常

问题记录：
1. ________________________________
2. ________________________________
3. ________________________________

备注：
________________________________
________________________________
```

## 🔧 调试技巧

### 1. 查看React路由状态
在浏览器控制台执行：
```javascript
console.log(window.location.pathname);
```

### 2. 查看Supabase认证状态
在浏览器控制台执行：
```javascript
// 在任意页面的组件中
import { supabase } from './lib/supabaseClient';
const { data } = await supabase.auth.getSession();
console.log('Current session:', data);
```

### 3. 查看用户权限
在浏览器控制台执行：
```javascript
// 检查access_grants
const { data } = await supabase
  .from('access_grants')
  .select('*')
  .eq('user_id', 'USER_ID_HERE');
console.log('User grants:', data);
```

## ✅ 验收标准

系统可以投入使用的条件：
1. ✅ 所有路由跳转正确
2. ✅ 登录/注册功能正常
3. ✅ 权限系统工作正常
4. ✅ 管理员可以管理用户
5. ✅ 会员可以访问功能
6. ✅ 没有明显的UI问题
7. ✅ 没有控制台错误
8. ✅ 数据正确保存到数据库

通过以上测试后，系统即可部署到生产环境！


